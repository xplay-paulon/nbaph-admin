<?phpinclude('../sql.php');function resize_image($file, $width, $height) {   $filename = "../images/carousel/" . $file;   list($width_orig, $height_orig) = getimagesize($filename);   $ratio_orig = $width_orig/$height_orig;   if ($width/$height > $ratio_orig) {      $width = $height*$ratio_orig;   } else {      $height = $width/$ratio_orig;   }   //header('Content-type: image/jpeg');   $image = imagecreatefromjpeg($filename);   $image_p = imagecreatetruecolor($width, $height);   imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);   // Output   imagejpeg($image_p, $filename, 100);   imagedestroy($image_p);}function generate_filename() {   $chars = "abcdefghijklmnopqrstuvwxyz0123456789";   $random = "";   for ($i = 0; $i < 32; $i += 1) {      $rand = rand() % strlen($chars);      $random .= substr($chars, $rand, 1);   }   return "$random.jpg";}if ($_POST['carouselid']) {   if ($_POST['action'] == "edit") {      $results = mysql_query("select * from carousel where CarouselID = '" . $_POST['carouselid'] . "'");      $row = mysql_fetch_array($results);   }   else if ($_POST['action'] == "delete") {      $results = mysql_query("select Image from carousel where CarouselID = '" . mysql_real_escape_string($_POST['carouselid']) . "'");      $del = mysql_fetch_array($results);      //unlink("../" . $del['Image']);      mysql_query("delete from carousel where CarouselID = '" . mysql_real_escape_string($_POST['carouselid']) . "'");   }   else {      $filename = $_POST['orig_image'];      /*if (basename($_FILES['image']['name'])) {         if (move_uploaded_file($_FILES['image']['tmp_name'], "../" . $filename))            resize_image($filename, 672, 672);         else            echo "<!-- image not written -->\n";      }*/      $date_posted = '';      if ($_POST['date'] && $_POST['month'] && $_POST['year'])         $date_posted = ", DatePosted = '" . $_POST['year']. "-" . $_POST['month'] . "-" . $_POST['date'] . "'";      mysql_query("update carousel set Video ='" . mysql_real_escape_string($_POST['video']) . "', Title = '" . mysql_real_escape_string($_POST['title']) . "', Source = '" . mysql_real_escape_string($_POST['source']) . "', Intro = '" . mysql_real_escape_string($_POST['intro']) . "', Link = '" . mysql_real_escape_string($_POST['link']) . "', Image = '$filename', ImageThumb = '" . mysql_real_escape_string($_POST['thumb']) . "'$date_posted where CarouselID = '" . mysql_real_escape_string($_POST['carouselid']) . "'");   }}else if ($_POST['title']) {   $filename = $_POST['orig_image'];   /*if (basename($_FILES['image']['name'])) {      $filename = generate_filename();      if (move_uploaded_file($_FILES['image']['tmp_name'], "../images/carousel/" . $filename))         resize_image($filename, 672, 672);   }*/   $date_posted = "NOW()";   if ($_POST['date'] && $_POST['month'] && $_POST['year'])      $date_posted = "'" . $_POST['year']. "-" . $_POST['month'] . "-" . $_POST['date'] . "'";   $q = "insert into carousel (Title, Image, Source, Intro, Link, DatePosted, ImageThumb, Video) values ('" . mysql_real_escape_string($_POST['title']) . "', '" . mysql_real_escape_string($filename) . "', '" . mysql_real_escape_string($_POST['source']) . "', '" . mysql_real_escape_string($_POST['intro']) . "', '" . mysql_real_escape_string($_POST['link']) . "', $date_posted, '" . mysql_real_escape_string($_POST['thumb']) . "','" . mysql_real_escape_string($_POST['video']) . "')";   mysql_query($q);   echo "<!-- $q -->\n";}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>NBA Philippines Admin</title><link rel="stylesheet" type="text/css" href="style.css"><script type="text/javascript" src="../jquery-1.7.1.min.js"></script><script type="text/javascript" src="tiny_mce/tiny_mce.js"></script><script type="text/javascript"><!--tinyMCE.init({   mode : "textareas",   theme : "advanced",   /*relative_urls : false,   convert_urls : true,   remove_script_host : false,*/   relative_urls : false,   convert_urls : true,   remove_script_host : false,   plugins : "safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",   theme_advanced_buttons1: "bold,italic,underline,strikethrough,|,cut,copy,pasteword,|,undo,redo,|,link,unlink,|,bullist,numlist,|,forecolor",   theme_advanced_buttons2 : "justifyleft,justifycenter,justifyright,justifyfull,|,image,code",   theme_advanced_buttons3 : "",   theme_advanced_toolbar_location : "top",   theme_advanced_toolbar_align : "left",   theme_advanced_statusbar_location : "bottom",   theme_advanced_resizing : true});function verify_delete(targ) {   if ($("#action" + targ).prop('value') == "delete") {      var conf = confirm("Are you sure you want to delete this entry?");      if (conf) {         return true;      }      return false;   }   return true;}--></script></head><body>   <?php   include('header.php');   ?>   <div id="main">      <form action="carousel.php?page=<?php echo $_GET['page']; ?>" id="carousel_form" name="carousel_form" method="post" enctype="multipart/form-data">         <input type="hidden" name="carouselid" value="<?php echo stripslashes($row['CarouselID']); ?>">         <table>            <tr>               <td>                  Article Title:               </td>               <td>                  <input type="text" name="title" value="<?php echo stripslashes($row['Title']); ?>">               </td>            </tr>            <tr>               <td>                  Video               </td>               <td>                  <input type="text" name="video" value="<?php echo stripslashes($row['Video']); ?>">               </td>            </tr>            <tr>               <td>                  Link:               </td>               <td>                  <input type="text" name="link" value="<?php echo stripslashes($row['Link']); ?>">               </td>            </tr>            <tr>               <td>                  Image:               </td>               <td>                  <!-- input type="file" name="image">                  <input type="hidden" name="orig_image" value="<?php echo stripslashes($row['Image']); ?>" -->                  <input type="text" name="orig_image" value="<?php echo stripslashes($row['Image']); ?>"> (672x376)               </td>            </tr>            <tr>               <td>                  Thumbnail:               </td>               <td>                  <input type="text" name="thumb" value="<?php echo stripslashes($row['ImageThumb']); ?>"> (132x70)               </td>            </tr>            <tr>               <td>                  Source:               </td>               <td>                  <input type="radio" name="source" id="US" value="US"<?php                  if ($row['Source'] == "US")                     echo ' checked="checked"';                  ?>> <label for="US">US</label>                  <input type="radio" name="source" id="PH" value="PH"<?php                  if ($row['Source'] == "PH")                     echo ' checked="checked"';                  ?>> <label for="PH">PH</label>                                 </td>            </tr>            <tr>               <td>                  Writeup:               </td>               <td>                  <textarea name="intro"><?php echo stripslashes($row['Intro']); ?></textarea>               </td>            </tr>            <tr>               <td>                  Sticky until:               </td>               <td>                  <select name="month">                     <option value="">-- optional --</option><?php$ex = explode("-", $row['DatePosted']);?>                     <option value="01"<?php                     if ($ex[1] == "01")                        echo ' selected="selected"';                     ?>>Jan</option>                     <option value="02"<?php                     if ($ex[1] == "02")                        echo ' selected="selected"';                     ?>>Feb</option>                     <option value="03"<?php                     if ($ex[1] == "03")                        echo ' selected="selected"';                     ?>>Mar</option>                     <option value="04"<?php                     if ($ex[1] == "04")                        echo ' selected="selected"';                     ?>>Apr</option>                     <option value="05"<?php                     if ($ex[1] == "05")                        echo ' selected="selected"';                     ?>>May</option>                     <option value="06"<?php                     if ($ex[1] == "06")                        echo ' selected="selected"';                     ?>>Jun</option>                     <option value="07"<?php                     if ($ex[1] == "07")                        echo ' selected="selected"';                     ?>>Jul</option>                     <option value="08"<?php                     if ($ex[1] == "08")                        echo ' selected="selected"';                     ?>>Aug</option>                     <option value="09"<?php                     if ($ex[1] == "09")                        echo ' selected="selected"';                     ?>>Sep</option>                     <option value="10"<?php                     if ($ex[1] == "10")                        echo ' selected="selected"';                     ?>>Oct</option>                     <option value="11"<?php                     if ($ex[1] == "11")                        echo ' selected="selected"';                     ?>>Nov</option>                     <option value="12"<?php                     if ($ex[1] == "12")                        echo ' selected="selected"';                     ?>>Dec</option>                  </select>                  <select name="date">                     <option value="">-- optional --</option><?phpfor ($i = 1; $i < 32; $i += 1) {?>                     <option value="<?php                     if ($i < 10)                        echo "0";                     echo $i;                     ?>"<?php                     if (intval($ex[2]) == $i)                        echo ' selected="selected"';                     ?>><?php echo $i; ?></option><?php}?>                  </select>                  <select name="year">                     <option value="">-- optional --</option><?phpfor ($i = 2010; $i < date("Y") + 5; $i += 1) {?>                     <option value="<?php echo $i; ?>"<?php                     if ($ex[0] == $i)                        echo ' selected="selected"';                     ?>><?php echo $i; ?></option><?php}?>                  </select>                  <div style="font-size: 12px">                     (if date, month or year are left blank, today's date will be used for new entries and no changes will be made to old entries)                  </div>               </td>            </tr>            <tr>               <td></td>               <td>                  <input type="submit" value="save">               </td>            </tr>         </table>      </form>      <table cellspacing="0" cellpadding="5" border="1" style="margin-top: 30px; width: 100%">         <tr>            <td>               Title            </td>            <td>               Link            </td>            <td style="width: 300px">               Image            </td>            <td style="width: 45px">               Source            </td>            <td style="width: 105px"></td>         </tr><?php$page_max = 5;$page = 0;if ($_GET['page'])   $page = $_GET['page'] * $page_max;$results = mysql_query("select * from carousel");$total = mysql_num_rows($results) / $page_max;$results = mysql_query("select * from carousel order by CarouselID desc limit $page, $page_max");$count = 0;while($row = mysql_fetch_array($results)) {   $style = "";   if ($count % 2 == 0)      $style = ' style="background: #ccc"';?>         <tr<?php echo $style; ?>>            <td>               <?php echo stripslashes($row['Title']); ?>            </td>            <td>               <?php echo stripslashes($row['Link']); ?>            </td>            <td>               <img src="<?php echo stripslashes($row['Image']); ?>" width="300" height="300">            </td>            <td>               <?php echo stripslashes($row['Source']); ?>            </td>            <td>               <form action="carousel.php?page=<?php echo $_GET['page']; ?>" method="post" onsubmit="return verify_delete(<?php echo $row['CarouselID']; ?>)">                  <input type="hidden" name="action" id="action<?php echo $row['CarouselID']; ?>">                  <input type="hidden" name="carouselid" value="<?php echo $row['CarouselID']; ?>">                  <input type="submit" value="edit" onclick="$('#action<?php echo $row['CarouselID']; ?>').prop('value', 'edit')">                  <input type="submit" value="delete" onclick="$('#action<?php echo $row['CarouselID']; ?>').prop('value', 'delete')">               </form>            </td>         </tr><?php}?>         <tr>            <td colspan="5"><?phpfor ($i = 0; $i < $total; $i += 1) {   if ($i * $page_max == $page)      echo ($i + 1);   else      echo '<a href="carousel.php?page=' . $i . '">' . ($i + 1) . '</a>';   if ($i + 1 < $total)      echo " | ";}?>            </td>         </tr>      </table>   </div><script type="text/javascript"><!----></script></body></html>